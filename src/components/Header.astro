---
import ThemeToggle from '@/components/ThemeToggle.astro';
import { navItems } from '@/lib/nav';
---

<header
    class="bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 w-full px-4 py-4 flex items-center justify-between border-b border-border sticky top-0 z-50"
    role="banner"
>
    <!-- Mobile Header: hamburger (left), logo (center), CTA (right) -->
    <div class="grid grid-cols-3 items-center w-full md:hidden">
        <!-- Hamburger Menu Trigger (left) -->
        <details class="relative">
            <summary
                class="list-none inline-flex h-10 w-10 items-center justify-center rounded-md border border-border text-foreground hover:bg-muted/60 cursor-pointer"
                aria-label="Open navigation"
                role="button"
            >
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    width="22"
                    height="22"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    class=""
                >
                    <line x1="3" y1="6" x2="21" y2="6"></line>
                    <line x1="3" y1="12" x2="21" y2="12"></line>
                    <line x1="3" y1="18" x2="21" y2="18"></line>
                </svg>
            </summary>

            <!-- Mobile Menu Panel -->
            <div
                class="absolute left-0 top-[3rem] bg-popover text-popover-foreground border border-border rounded-lg shadow-xl w-[90vw] max-w-sm p-2 z-50"
            >
                <nav class="flex flex-col gap-1" aria-label="Mobile navigation">
                    {
                        navItems
                            .filter((i) => !i.button)
                            .map((item) =>
                                item.children ? (
                                    <details class="group rounded-md">
                                        <summary class="flex items-center justify-between px-3 py-2 cursor-pointer select-none rounded-md text-sm font-semibold text-foreground hover:bg-muted/50 list-none">
                                            <a
                                                href={item.href || '#'}
                                                class="text-foreground/90 hover:text-foreground"
                                            >
                                                {item.title}
                                            </a>
                                            <svg
                                                xmlns="http://www.w3.org/2000/svg"
                                                width="16"
                                                height="16"
                                                viewBox="0 0 24 24"
                                                fill="none"
                                                stroke="currentColor"
                                                stroke-width="2"
                                                stroke-linecap="round"
                                                stroke-linejoin="round"
                                                class="opacity-60 transition-transform group-open:rotate-180"
                                            >
                                                <path d="m6 9 6 6 6-6" />
                                            </svg>
                                        </summary>
                                        <div class="pl-3 pb-2">
                                            {item.children.map((child) => (
                                                <a
                                                    href={child.href}
                                                    class="block px-3 py-2 text-sm rounded-md text-foreground/90 hover:bg-muted/40"
                                                >
                                                    {child.title}
                                                </a>
                                            ))}
                                        </div>
                                    </details>
                                ) : (
                                    <a
                                        href={item.href || '#'}
                                        class="px-3 py-2 rounded-md text-sm font-semibold text-foreground hover:bg-muted/50"
                                    >
                                        {item.title}
                                    </a>
                                ),
                            )
                    }
                    <div class="px-3 py-2">
                        <ThemeToggle />
                    </div>
                </nav>
            </div>
        </details>

        <!-- Logo (center) -->
        <div class="flex items-center justify-center">
            <a href="/" class="flex items-center" aria-label="Haul homepage">
                <img src="/goat_logo_white.png" alt="Haul Logo" class="h-8 w-auto logo-white" />
                <img src="/goat_logo_dark.png" alt="Haul Logo" class="h-8 w-auto logo-dark" />
            </a>
        </div>

        <!-- Mobile CTA: Book a Move (right) -->
        <div class="flex items-center justify-end">
            {
                navItems
                    .filter((i) => i.button)
                    .map((item) => (
                        <a
                            href={item.href}
                            class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4"
                            aria-label={item.title}
                        >
                            {item.title}
                        </a>
                    ))
            }
        </div>
    </div>

    <!-- Desktop Header: logo (left) + full nav (right) -->
    <div class="hidden md:flex items-center justify-between w-full">
        <div class="text-2xl font-bold text-foreground">
            <a href="/" class="flex items-center" aria-label="Haul homepage">
                <img src="/goat_logo_white.png" alt="Haul Logo" class="h-8 w-auto logo-white" />
                <img src="/goat_logo_dark.png" alt="Haul Logo" class="h-8 w-auto logo-dark" />
            </a>
        </div>

        <nav class="flex gap-8 items-center" aria-label="Main navigation">
            {
                navItems.map((item) =>
                    item.button ? (
                        <a
                            href={item.href}
                            class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-5"
                            aria-label={item.title}
                        >
                            {item.title}
                        </a>
                    ) : (
                        <div class="relative group">
                            <a
                                href={item.href || '#'}
                                class="text-sm font-semibold text-foreground hover:text-primary flex items-center gap-1 py-2 transition-colors"
                            >
                                {item.title}
                                {item.children && (
                                    <svg
                                        xmlns="http://www.w3.org/2000/svg"
                                        width="14"
                                        height="14"
                                        viewBox="0 0 24 24"
                                        fill="none"
                                        stroke="currentColor"
                                        stroke-width="2.5"
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        class="transition-transform group-hover:rotate-180 opacity-50"
                                    >
                                        <path d="m6 9 6 6 6-6" />
                                    </svg>
                                )}
                            </a>

                            {item.children && (
                                <div class="absolute left-0 top-full hidden group-hover:block pt-0">
                                    <div class="bg-popover text-popover-foreground border border-border rounded-lg shadow-xl min-w-[220px] overflow-hidden mt-2 p-1 animate-in fade-in zoom-in-95 duration-200">
                                        {item.children.map((child) => (
                                            <a
                                                href={child.href}
                                                class="block px-4 py-2.5 text-sm font-medium rounded-md hover:bg-primary hover:text-primary-foreground transition-colors"
                                            >
                                                {child.title}
                                            </a>
                                        ))}
                                    </div>
                                </div>
                            )}
                        </div>
                    ),
                )
            }
            <ThemeToggle />
        </nav>
    </div>
</header>
